import{t as U,v as Q,c as N,a as Y,A as F,q as u,u as m,b as I,D as Z,o as L,I as j,d as b,m as a,k as y,F as M,l as o,h as f,_hW as g}from"./q-Q7QTf1-t.js";import{s as R,p as V,m as k,b as H,a as D,e as G}from"./q-D0R3-wP7.js";import{_}from"./q-BKaOGYNW.js";import{O as $,S as X,B as W}from"./q-CXrtXnGn.js";import"./q-Cfw5b693.js";import{a0 as x}from"./q-D3Ga_9CS.js";import{L as K}from"./q-DuaMw4NT.js";import{u as J,O as ee}from"./q-D-hFNuXB.js";import"./q-R_PFgutd.js";import{e as te,h as oe}from"./q-CQTmAhrD.js";import{u as re}from"./q-bWKQX6P2.js";import{D as ne}from"./q-xouav5_y.js";import{u as se}from"./q-DlwICHcG.js";import"./q-CX_U-nEJ.js";import"./q-DHhu6Rit.js";import"./q-C6JuRMDH.js";import"./q-B-GNphMI.js";import"./q-DTPKyc3d.js";const ae={...ne,selected:{}},B=N("subscription-store"),ot=e=>{const t={...ae,...e},r=U(t);return Q(B,r),r},ie=()=>{const e=Y(B),t=u(()=>_(()=>import("./q-BnTnerhY.js").then(r=>r.a),[]),"s_FZjXpimr7d8",[e]);return F(u(()=>_(()=>import("./q-BnTnerhY.js").then(r=>r.s),[]),"s_G22pSUr0YFM",[e])),{subscriptionStore:e,fetchSubscriptionList:t}},le=()=>{const[e,t]=m();if(e.value===4)return[{quantity:1,discount:0}];const r=[{quantity:1,discount:0}];return t.subscriptionStore.detail?r.concat(t.subscriptionStore.detail.discount.map(s=>({quantity:s.quantity,discount:s.discount}))):r},ue=Object.freeze(Object.defineProperty({__proto__:null,s_SRzq4onWrBM:le},Symbol.toStringTag,{value:"Module"})),_e=()=>{const[e,t]=m();t(e.value)},de=Object.freeze(Object.defineProperty({__proto__:null,s_Z5aBAqv4iT0:_e},Symbol.toStringTag,{value:"Module"})),ce=async()=>{const[e,t,r,s,d]=m();s.value=new URLSearchParams(window.location.search);const i=Number(s.value.get("id")||0);d.subscriptionStore.list.length===0&&await d.fetchSubscriptionList(),i&&r.value!==4&&(d.subscriptionStore.selected={id:i},e()),setTimeout(()=>{t.value=!1},500)},me=Object.freeze(Object.defineProperty({__proto__:null,_hW:g,s_TLEV4KZHtUQ:ce},Symbol.toStringTag,{value:"Module"})),pe=()=>{var t;const[e]=m();return Number(((t=e.value)==null?void 0:t.get("type"))||1)},ve=Object.freeze(Object.defineProperty({__proto__:null,s_5F5mcYnOO14:pe},Symbol.toStringTag,{value:"Module"})),be=(e,t)=>{const[r]=m();r.value=t.value},he=Object.freeze(Object.defineProperty({__proto__:null,_hW:g,s_cPYvI8VTAmA:be},Symbol.toStringTag,{value:"Module"})),ye=e=>{const[t]=m();if(!e||e.trim()==="")return"";const r=R(V(D(),H(6,t.password.minLength),k(20,t.password.maxLength)),e);return r.success?"":r.issues[0].message},fe=Object.freeze(Object.defineProperty({__proto__:null,_hW:g,s_1RulbejlHoM:ye},Symbol.toStringTag,{value:"Module"})),ge=()=>{const[e,t]=m();t.email(e.value)},Se=Object.freeze(Object.defineProperty({__proto__:null,s_G5SBf6nMUoM:ge},Symbol.toStringTag,{value:"Module"})),Te=e=>{const[t,r]=m();if(t.userStore.meta.authenticated)return"";const s=R(V(D(),G(r.email)),e||"");return s.success?"":s.issues[0].message},Pe=Object.freeze(Object.defineProperty({__proto__:null,_hW:g,s_XTCGplgD2IY:Te},Symbol.toStringTag,{value:"Module"})),Oe=e=>{var d;const[t,r,s]=m();t.value=e,r((d=s.internal.fields.coupon)==null?void 0:d.value)},xe=Object.freeze(Object.defineProperty({__proto__:null,_hW:g,s_ssmNrvI00o8:Oe},Symbol.toStringTag,{value:"Module"})),Ie=e=>{const[t]=m();t.value=e},Ee=Object.freeze(Object.defineProperty({__proto__:null,_hW:g,s_en3baesFiZ0:Ie},Symbol.toStringTag,{value:"Module"})),qe=I(u(()=>_(()=>import("./q-DzlV8rO-.js").then(e=>e.a),[]),"s_jZPZx0c087w")),we=I(u(()=>_(()=>import("./q-FgpHh-dh.js").then(e=>e.p),[]),"s_0QfjK1daSeY")),Ce=I(u(()=>_(()=>import("./q-m1Yh-OZQ.js").then(e=>e.q),[]),"s_RMC9nqtoJ00")),Ae=()=>{var w,C,A;Z();const t=re().config.site.site_name,r=L(!0),s=se(),d=L(null),i=j(u(()=>_(()=>Promise.resolve().then(()=>ve),void 0),"s_5F5mcYnOO14",[d])),p=ie(),c=J(),h={email:`无效的电子邮件地址格式`,password:{optional:`如果您不设置密码，系统将自动生成一个并发送到您的电子邮件`,minLength:`密码至少为6个字符`,maxLength:`密码最多为20个字符`}},[v,{Form:E,Field:S}]=te({loader:{value:{auth_type:void 0,identifier:void 0,password:void 0,payment:void 0,subscribe_id:void 0,quantity:void 0,coupon:void 0,turnstile_token:void 0,amount:1e3,invite_code:void 0}}}),T={email:u(()=>_(()=>Promise.resolve().then(()=>Pe),void 0),"s_XTCGplgD2IY",[s,h]),password:u(()=>_(()=>Promise.resolve().then(()=>fe),void 0),"s_1RulbejlHoM",[h])},O=u(()=>_(()=>Promise.resolve().then(()=>Ve),void 0),"s_pdqicBscScg",[c,v,i,d]),z=u(()=>_(()=>Promise.resolve().then(()=>Fe),void 0),"s_uLfXH3VrssU",[c,i,d]);F(u(()=>_(()=>Promise.resolve().then(()=>me),void 0),"s_TLEV4KZHtUQ",[O,r,i,d,p]));const q=j(u(()=>_(()=>Promise.resolve().then(()=>ue),void 0),"s_SRzq4onWrBM",[i,p]));return b("div",null,{class:"container pb-20 md:pb-6"},[r.value&&a(K,null,3,"oC_0"),b("section",null,{class:"my-8 text-center md:mb-12 md:text-left"},s.userStore.meta.authenticated?a(M,{children:[b("h2",null,{class:"text-xl font-semibold"},`创建订单`,1,null),b("p",null,{class:"text-sm text-zinc-400"},[`当前账户`,":"," ",y(n=>{var l;return(l=n.userStore.detail)==null?void 0:l.auth_methods[0].auth_identifier},[s])],1,null)]},1,"oC_2"):b("h2",null,{class:"text-xl font-semibold"},`输入您希望用于 ${t} 账户的电子邮件地址`,1,"oC_1"),1,null),b("section",null,{class:"flex flex-col md:flex-row"},[b("div",null,{class:"mb-4 w-full flex-auto md:mr-8 md:mb-0 md:basis-3xl lg:min-h-[calc(100vh-120px)]"},a(E,{onSubmit$:z,class:"w-full",children:[!s.userStore.meta.authenticated&&b("div",null,{class:"mb-8"},[a(S,{name:"identifier",get validate(){return T.email},validateOn:"change",children:(n,l)=>a(x,{...l,type:"email",placeholder:`输入您的电子邮件地址`,get value(){return n.value},get error(){return n.error},onBlur$:u(()=>_(()=>Promise.resolve().then(()=>Se),void 0),"s_G5SBf6nMUoM",[n,T]),[o]:{type:o,value:f(n,"value"),error:f(n,"error")}},0,"oC_3"),[o]:{name:o,validate:f(T,"email"),validateOn:o}},3,"oC_4"),a(S,{name:"password",get validate(){return T.password},children:(n,l)=>a(x,{...l,type:"password",placeholder:`您的账户密码（可选）`,get value(){return n.value},error:n.error||" "+h.password.optional,[o]:{type:o,value:f(n,"value")}},0,"oC_5"),[o]:{name:o,validate:f(T,"password")}},3,"oC_6"),b("div",null,{class:"flex flex-col-reverse"},a($,null,3,"oC_7"),1,null),b("p",null,{class:"text-sm text-zinc-400"},`我们不会将您的电子邮件地址分享给任何第三方，仅在必要时与您联系，以确保服务质量或发送通知。`,1,null)],1,"oC_8"),s.userStore.meta.authenticated&&i.value===2&&a(S,{name:"quantity",type:"number",children:n=>a(Ce,{get value(){return n.value},get options(){return q.value},get unitTime(){var l;return(l=p.subscriptionStore.detail)==null?void 0:l.unit_time},onQuantityChange$:u(()=>_(()=>Promise.resolve().then(()=>xe),void 0),"s_ssmNrvI00o8",[n,O,v]),[o]:{value:f(n,"value"),options:y(l=>l.value,[q]),unitTime:y(l=>{var P;return(P=l.subscriptionStore.detail)==null?void 0:P.unit_time},[p])}},2,"oC_9"),[o]:{name:o,type:o}},3,"oC_10"),s.userStore.meta.authenticated&&i.value===4&&a(S,{name:"amount",type:"number",children:n=>a(qe,{get value(){return n.value},get loading(){return c.orderStore.loading.create},onAmountChange$:u(()=>_(()=>Promise.resolve().then(()=>Ee),void 0),"s_en3baesFiZ0",[n]),[o]:{value:f(n,"value"),loading:y(l=>l.orderStore.loading.create,[c])}},2,"oC_11"),[o]:{name:o,type:o}},3,"oC_12"),a(S,{name:"payment",type:"number",children:n=>a(we,{get loading(){return c.orderStore.loading.create},get hideBalance(){return!s.userStore.meta.authenticated||i.value===4},onPaymentMethodSelect$:u(()=>_(()=>Promise.resolve().then(()=>je),void 0),"s_PUc39QTQbbk",[n,v]),[o]:{loading:y(l=>l.orderStore.loading.create,[c]),hideBalance:y((l,P)=>!P.userStore.meta.authenticated||l.value===4,[i,s])}},3,"oC_13"),[o]:{name:o,type:o}},3,"oC_14")],[o]:{onSubmit$:o,class:o}},1,"oC_15"),1,null),a(ee,{get previewOrder(){return c.orderStore.meta.pre},get product(){return p.subscriptionStore.detail},config:{type:i.value,quantity:i.value===2?Number(((w=v.internal.fields.quantity)==null?void 0:w.value)||1):Number(((C=d.value)==null?void 0:C.get("frequency"))||1),amount:i.value===4?Number(((A=v.internal.fields.amount)==null?void 0:A.value)||0):void 0},children:[1,2].includes(i.value)&&a(M,{children:[a(X,{class:"my-4",[o]:{class:o}},3,"oC_16"),a(S,{name:"coupon",children:n=>a(x,{ghost:!0,type:"text",placeholder:`输入优惠券代码`,class:"w-full",get value(){return n.value},onInput$:u(()=>_(()=>Promise.resolve().then(()=>he),void 0),"s_cPYvI8VTAmA",[n]),children:b("div",{"q:slot":"suffix"},null,a(W,{class:"h-full border-0 whitespace-nowrap shadow-none",onClick$:u(()=>_(()=>Promise.resolve().then(()=>de),void 0),"s_Z5aBAqv4iT0",[n,O]),children:`应用`,[o]:{class:o}},1,"oC_17"),1,null),[o]:{ghost:o,type:o,class:o,value:f(n,"value")}},0,"oC_18"),[o]:{name:o}},3,"oC_19")]},1,"oC_20"),[o]:{previewOrder:y(n=>n.orderStore.meta.pre,[c]),product:y(n=>n.subscriptionStore.detail,[p])}},1,"oC_21")],1,null)],1,"oC_22")},rt=Object.freeze(Object.defineProperty({__proto__:null,s_Ae00pvyf0qI:Ae},Symbol.toStringTag,{value:"Module"})),Le=e=>{const[t,r]=m();t.value=e,oe(r)},je=Object.freeze(Object.defineProperty({__proto__:null,s_PUc39QTQbbk:Le},Symbol.toStringTag,{value:"Module"})),Me=async e=>{var c,h,v;const[t,r,s]=m(),d=Number(((c=s.value)==null?void 0:c.get("id"))||0),i=Number(((h=s.value)==null?void 0:h.get("frequency"))||1),p=Number(((v=s.value)==null?void 0:v.get("subscribe_id"))||0);switch(r.value){case 2:t.handleRenewal({user_subscribe_id:p,payment:e.payment,quantity:e.quantity||1,coupon:e.coupon});return;case 3:t.handleResetTraffic({user_subscribe_id:p,payment:e.payment});return;case 4:t.handleRecharge({amount:e.amount,payment:e.payment});return;default:t.handlePurchase({auth_type:"email",identifier:e.identifier,password:e.password,payment:e.payment,subscribe_id:d,quantity:i||1,coupon:e.coupon,turnstile_token:"",invite_code:localStorage.getItem("invite_code")||void 0});return}},Fe=Object.freeze(Object.defineProperty({__proto__:null,_hW:g,s_uLfXH3VrssU:Me},Symbol.toStringTag,{value:"Module"})),Re=e=>{var c,h,v;const[t,r,s,d]=m();if([3,4].includes(s.value))return;const i=Number(((c=d.value)==null?void 0:c.get("id"))||0),p=Number(((h=d.value)==null?void 0:h.get("frequency"))||1);try{t.handlePrePurchase({payment:-1,subscribe_id:i,quantity:s.value===2?Number(((v=r.internal.fields.quantity)==null?void 0:v.value)||1):p,coupon:e})}catch{r.internal.fields.coupon.value=""}},Ve=Object.freeze(Object.defineProperty({__proto__:null,_hW:g,s_pdqicBscScg:Re},Symbol.toStringTag,{value:"Module"}));export{g as _hW,ie as a,rt as i,ye as s_1RulbejlHoM,pe as s_5F5mcYnOO14,Ae as s_Ae00pvyf0qI,ge as s_G5SBf6nMUoM,Le as s_PUc39QTQbbk,le as s_SRzq4onWrBM,ce as s_TLEV4KZHtUQ,Te as s_XTCGplgD2IY,_e as s_Z5aBAqv4iT0,be as s_cPYvI8VTAmA,Ie as s_en3baesFiZ0,Re as s_pdqicBscScg,Oe as s_ssmNrvI00o8,Me as s_uLfXH3VrssU,ot as u};
