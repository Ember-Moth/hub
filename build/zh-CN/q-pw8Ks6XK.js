import{u as useLexicalScope,_hW}from"./q-Q7QTf1-t.js";import{u as unsubscribe,p as preUnsubscribe,c as queryUserSubscribe,r as resetUserSubscribeToken}from"./q-CfDE7YpQ.js";import{A as API_URL}from"./q-C6JuRMDH.js";import{e as extractDomain,d as universalBase64Encode}from"./q-D2_mtX5_.js";import"./q-BKaOGYNW.js";import"./q-R_PFgutd.js";import"./q-Cfw5b693.js";import"./q-DTPKyc3d.js";import"./q-DlwICHcG.js";import"./q-CXrtXnGn.js";import"./q-D3Ga_9CS.js";import"./q-CX_U-nEJ.js";import"./q-B-GNphMI.js";import"./q-bWKQX6P2.js";import"./q-xouav5_y.js";const s_nTc05qFKGSw=async e=>{const[s,t]=useLexicalScope();if(t.loading.update)return!1;t.loading.update=!0;try{return await unsubscribe({id:e}),await s(),!0}catch{return!1}finally{t.loading.update=!1}},subscribe_ts_useSubscribe_handleUnsubscribe_nTc05qFKGSw=Object.freeze(Object.defineProperty({__proto__:null,_hW,s_nTc05qFKGSw},Symbol.toStringTag,{value:"Module"})),s_osaoPAQgIy4=async e=>{const[s]=useLexicalScope();if(s.loading.update)return null;s.loading.update=!0;try{const{data:t}=await preUnsubscribe({id:e});return s.meta.unsubscribe=t.data,t.data}catch{return null}finally{s.loading.update=!1}},subscribe_ts_useSubscribe_handlePreUnsubscribe_osaoPAQgIy4=Object.freeze(Object.defineProperty({__proto__:null,_hW,s_osaoPAQgIy4},Symbol.toStringTag,{value:"Module"})),s_b8Z6FF4LGTk=async()=>{var s;const[e]=useLexicalScope();if(!(e.loading.list&&e.list.length>0)){e.loading.list=!0;try{const{data:t}=await queryUserSubscribe();e.list=((s=t.data)==null?void 0:s.list)||[],e.list.length>0&&(e.meta.activeIndex<0||e.meta.activeIndex>=e.list.length)&&(e.meta.activeIndex=0)}catch{e.list=[]}finally{e.loading.list=!1}}},subscribe_ts_useSubscribe_fetchSubscribeList_b8Z6FF4LGTk=Object.freeze(Object.defineProperty({__proto__:null,_hW,s_b8Z6FF4LGTk},Symbol.toStringTag,{value:"Module"})),s_0SobuyGSWk0=({track:e})=>{const[s]=useLexicalScope();e(()=>s.meta.activeIndex),e(()=>s.list),s.list.length>0&&s.meta.activeIndex>=0&&s.meta.activeIndex<s.list.length?s.selected=s.list[s.meta.activeIndex]:s.selected=null},subscribe_ts_useSubscribe_useTask_0SobuyGSWk0=Object.freeze(Object.defineProperty({__proto__:null,_hW,s_0SobuyGSWk0},Symbol.toStringTag,{value:"Module"})),s_h7EKg4utYFs=(e,s)=>{const[t,u,r]=useLexicalScope();if(!e)return"";const i=(u?u.split(`
`):[extractDomain(API_URL,t)]).map(c=>t?s?`https://${e}.${s}.${c}`:`https://${e}.${c}`:s?`https://${c}${r}?token=${e}&type=${s}`:`https://${c}${r}?token=${e}`),o=Math.floor(Math.random()*i.length);return i[o]},subscribe_ts_useSubscribe_generateSubscribeUrl_h7EKg4utYFs=Object.freeze(Object.defineProperty({__proto__:null,_hW,s_h7EKg4utYFs},Symbol.toStringTag,{value:"Module"})),s_e0ItAGwmrJE=async e=>{const[s,t]=useLexicalScope();if(!t.loading.update){t.loading.update=!0;try{await resetUserSubscribeToken({user_subscribe_id:e}),s()}finally{t.loading.update=!1}}},subscribe_ts_useSubscribe_resetUserSubscribe_e0ItAGwmrJE=Object.freeze(Object.defineProperty({__proto__:null,_hW,s_e0ItAGwmrJE},Symbol.toStringTag,{value:"Module"})),s_GUcdiDfMzZ4=async({track:e})=>{var r;const[s,t]=useLexicalScope();if(e(()=>t.selected),!((r=t.selected)!=null&&r.token)){t.meta.subscribeUrl="";return}const u=await s(t.selected.token);t.meta.subscribeUrl=u},subscribe_ts_useSubscribe_useTask_1_GUcdiDfMzZ4=Object.freeze(Object.defineProperty({__proto__:null,_hW,s_GUcdiDfMzZ4},Symbol.toStringTag,{value:"Module"})),s_GnSgI00mn78=async e=>{var n;const[s,t]=useLexicalScope();if(!((n=t.selected)!=null&&n.token))return"";const u=t.selected.token,r=await s(u,e);return e||(t.meta.subscribeUrl=r),r},subscribe_ts_useSubscribe_getUserSubscribe_GnSgI00mn78=Object.freeze(Object.defineProperty({__proto__:null,_hW,s_GnSgI00mn78},Symbol.toStringTag,{value:"Module"})),s_DnGqTr750tg=(url,schema)=>{const[site_name]=useLexicalScope(),name=site_name||"";if(!schema)return url;try{let result=schema;return result=result.replace(/\${url}/g,url),result=result.replace(/\${name}/g,name),result=result.replace(/\${encodeURIComponent\(([^)]+)\)}/g,(e,s)=>s==="url"?encodeURIComponent(url):s==="name"?encodeURIComponent(name):e),result=result.replace(/\${window\.btoa\(([^)]+)\)}/g,(e,s)=>{const t=typeof window<"u"?window.btoa:universalBase64Encode;return s==="url"?t(url):s==="name"?t(name):e}),result=result.replace(/\${JSON\.stringify\(([^}]+)\)}/g,(match,expr)=>{try{const processedExpr=expr.replace(/url/g,`"${url}"`).replace(/name/g,`"${name}"`);if(processedExpr.includes("server_remote")){const e=`${url}, tag=${name}`;return JSON.stringify({server_remote:[e]})}const result=eval(`(${processedExpr})`);return JSON.stringify(result)}catch{return match}}),result}catch(e){return url}},subscribe_ts_useSubscribe_getAppSubLink_DnGqTr750tg=Object.freeze(Object.defineProperty({__proto__:null,_hW,s_DnGqTr750tg},Symbol.toStringTag,{value:"Module"}));export{_hW,subscribe_ts_useSubscribe_handlePreUnsubscribe_osaoPAQgIy4 as a,subscribe_ts_useSubscribe_fetchSubscribeList_b8Z6FF4LGTk as b,subscribe_ts_useSubscribe_useTask_0SobuyGSWk0 as c,subscribe_ts_useSubscribe_generateSubscribeUrl_h7EKg4utYFs as d,subscribe_ts_useSubscribe_resetUserSubscribe_e0ItAGwmrJE as e,subscribe_ts_useSubscribe_useTask_1_GUcdiDfMzZ4 as f,subscribe_ts_useSubscribe_getUserSubscribe_GnSgI00mn78 as g,subscribe_ts_useSubscribe_getAppSubLink_DnGqTr750tg as h,subscribe_ts_useSubscribe_handleUnsubscribe_nTc05qFKGSw as s,s_0SobuyGSWk0,s_DnGqTr750tg,s_GUcdiDfMzZ4,s_GnSgI00mn78,s_b8Z6FF4LGTk,s_e0ItAGwmrJE,s_h7EKg4utYFs,s_nTc05qFKGSw,s_osaoPAQgIy4};
