import{u as h,b as Q,q as d,D as N,o as $,m as l,l as r,d as b,h as _,k as z,_hW as P}from"./q-Q7QTf1-t.js";import{_ as p}from"./q-BKaOGYNW.js";import{B as X,r as w,C as M}from"./q-CXrtXnGn.js";import"./q-Cfw5b693.js";import{a0 as I,a1 as G,a2 as J,a3 as W}from"./q-D3Ga_9CS.js";import{L as Z}from"./q-CX_U-nEJ.js";import{T as Y}from"./q-DHhu6Rit.js";import"./q-R_PFgutd.js";import{e as K}from"./q-CQTmAhrD.js";import{u as H}from"./q-bWKQX6P2.js";import"./q-C6JuRMDH.js";import"./q-B-GNphMI.js";import"./q-DTPKyc3d.js";var ee=/^[\w+-]+(?:\.[\w+-]+)*@[\da-z]+(?:[.-][\da-z]+)*\.[a-z]{2,}$/iu,g;function te(e){return{lang:(e==null?void 0:e.lang)??(g==null?void 0:g.lang),message:e==null?void 0:e.message,abortEarly:(e==null?void 0:e.abortEarly)??(g==null?void 0:g.abortEarly),abortPipeEarly:(e==null?void 0:e.abortPipeEarly)??(g==null?void 0:g.abortPipeEarly)}}var S;function ne(e){return S==null?void 0:S.get(e)}var q;function ae(e){return q==null?void 0:q.get(e)}var L;function oe(e,t){var n;return(n=L==null?void 0:L.get(e))==null?void 0:n.get(t)}function re(e){var n,o;const t=typeof e;return t==="string"?`"${e}"`:t==="number"||t==="bigint"||t==="boolean"?`${e}`:t==="object"||t==="function"?(e&&((o=(n=Object.getPrototypeOf(e))==null?void 0:n.constructor)==null?void 0:o.name))??"null":t}function T(e,t,n,o,a){const i=a&&"input"in a?a.input:n.value,c=(a==null?void 0:a.expected)??e.expects??null,y=(a==null?void 0:a.received)??re(i),u={kind:e.kind,type:e.type,input:i,expected:c,received:y,message:`Invalid ${t}: ${c?`Expected ${c} but r`:"R"}eceived ${y}`,requirement:e.requirement,path:a==null?void 0:a.path,issues:a==null?void 0:a.issues,lang:o.lang,abortEarly:o.abortEarly,abortPipeEarly:o.abortPipeEarly},x=e.kind==="schema",m=(a==null?void 0:a.message)??e.message??oe(e.reference,u.lang)??(x?ae(u.lang):null)??o.message??ne(u.lang);m&&(u.message=typeof m=="function"?m(u):m),x&&(n.typed=!1),n.issues?n.issues.push(u):n.issues=[u]}function F(e){return{kind:"validation",type:"email",reference:F,expects:null,async:!1,requirement:ee,message:e,_run(t,n){return t.typed&&!this.requirement.test(t.value)&&T(this,"email",t,n),t}}}function A(e,t){return{kind:"validation",type:"length",reference:A,async:!1,expects:`${e}`,requirement:e,message:t,_run(n,o){return n.typed&&n.value.length!==this.requirement&&T(this,"length",n,o,{received:`${n.value.length}`}),n}}}function B(e,t){return{kind:"validation",type:"max_length",reference:B,async:!1,expects:`<=${e}`,requirement:e,message:t,_run(n,o){return n.typed&&n.value.length>this.requirement&&T(this,"length",n,o,{received:`${n.value.length}`}),n}}}function V(e,t){return{kind:"validation",type:"min_length",reference:V,async:!1,expects:`>=${e}`,requirement:e,message:t,_run(n,o){return n.typed&&n.value.length<this.requirement&&T(this,"length",n,o,{received:`${n.value.length}`}),n}}}function D(e,t){return{kind:"validation",type:"regex",reference:D,async:!1,expects:`${e}`,requirement:e,message:t,_run(n,o){return n.typed&&!this.requirement.test(n.value)&&T(this,"format",n,o),n}}}function E(e){return{kind:"schema",type:"string",reference:E,expects:"string",async:!1,message:e,_run(t,n){return typeof t.value=="string"?t.typed=!0:T(this,"type",t,n),t}}}function O(...e){return{...e[0],pipe:e,_run(t,n){for(const o of e)if(o.kind!=="metadata"){if(t.issues&&(o.kind==="schema"||o.kind==="transformation")){t.typed=!1;break}(!t.issues||!n.abortEarly&&!n.abortPipeEarly)&&(t=o._run(t,n))}return t}}}function j(e,t,n){const o=e._run({typed:!1,value:t},te(n));return{typed:o.typed,success:!o.issues,output:o.value,issues:o.issues}}const se=e=>{const[t]=h();if(!e)return t.email.invalid;const n=j(O(E(),F(t.email.invalid)),e||"");return n.success?"":n.issues[0].message},le=Object.freeze(Object.defineProperty({__proto__:null,_hW:P,s_pUCzfI03sjc:se},Symbol.toStringTag,{value:"Module"})),ie=e=>{var a;const[t,n]=h(),o=(a=t.internal.fields.password)==null?void 0:a.value;return e!==o?n.password.mismatch:""},ue=Object.freeze(Object.defineProperty({__proto__:null,_hW:P,s_0Pww1bpBLjw:ie},Symbol.toStringTag,{value:"Module"})),_e=Q(d(()=>p(()=>import("./q-g00hwIww.js").then(e=>e.s),[]),"s_kaWKx8yxWf4")),ce=()=>{N();const e=H(),{auth:{email:{enable:t},mobile:{enable:n}}}=e.config,o={methods:{email:t,mobile:n}},a=$(o.methods.email?"email":o.methods.mobile?"mobile":"email"),i=$(!1),[c,{Form:y,Field:u}]=K({loader:{value:{telephone_area_code:"1",telephone:"",email:"",password:"",code:"",cf_token:""}}}),x=d(()=>p(()=>Promise.resolve().then(()=>Pe),void 0),"s_vtm9x6XoTaw",[i,c,a]),m={email:{invalid:`无效的电子邮件地址`,domainNotAllowed:`不允许使用该电子邮件域名`},telephone:{invalid:`无效的电话号码`,impossible:`电话号码无效`},password:{minLength:`密码至少为6个字符`,maxLength:`密码最多为20个字符`,mismatch:`密码不匹配`},code:{digitsOnly:`验证码必须仅包含数字`,length:`验证码必须为6位数字`}},f={email:d(()=>p(()=>Promise.resolve().then(()=>le),void 0),"s_pUCzfI03sjc",[m]),telephone:d(()=>p(()=>Promise.resolve().then(()=>Le),void 0),"s_FsUxrql0ffs",[c,m]),password:d(()=>p(()=>Promise.resolve().then(()=>Ie),void 0),"s_qw4PkSXqJLU",[m]),repeatPassword:d(()=>p(()=>Promise.resolve().then(()=>ue),void 0),"s_0Pww1bpBLjw",[c,m]),code:d(()=>p(()=>Promise.resolve().then(()=>ge),void 0),"s_u5uQPBR8gos",[m])};return l(y,{onSubmit$:x,class:"w-full",children:[b("div",null,{class:"mb-11 text-center"},[b("h1",null,{class:"mb-3 text-2xl font-bold"},`忘记密码？`,1,null),b("p",null,{class:"text-sm"},`为您的账户创建一个新密码`,1,null)],1,null),o.methods.email&&a.value==="email"&&l(u,{name:"email",get validate(){return f.email},children:(s,v)=>l(I,{...v,type:"email",label:`电子邮件`,description:`您的电子邮件地址`,placeholder:`输入您的电子邮件地址`,get value(){return s.value},get error(){return s.error},children:o.methods.mobile&&b("button",{"q:slot":"extra"},{class:"text-primary cursor-pointer text-sm hover:underline",type:"button",onClick$:d(()=>p(()=>Promise.resolve().then(()=>pe),void 0),"s_LL0ZzADe13I",[a])},`切换到电话号码`,1,"uP_0"),[r]:{type:r,value:_(s,"value"),error:_(s,"error")}},0,"uP_1"),[r]:{name:r,validate:_(f,"email")}},3,"uP_2"),o.methods.mobile&&a.value==="mobile"&&l(u,{name:"telephone",get validate(){return f.telephone},children:(s,v)=>l(I,{...v,type:"tel",label:`电话号码`,description:`您的电话号码`,placeholder:`输入您的电话号码`,get value(){return s.value},get error(){return s.error},children:[b("div",{"q:slot":"prefix"},null,l(G,{onChange$:d(()=>p(()=>Promise.resolve().then(()=>Se),void 0),"s_PL7QavR9mvo",[c])},2,"uP_3"),1,null),o.methods.email&&b("button",{"q:slot":"extra"},{class:"text-primary cursor-pointer text-sm hover:underline",type:"button",onClick$:d(()=>p(()=>Promise.resolve().then(()=>Te),void 0),"s_530x0LBC164",[a])},`切换到电子邮件`,1,"uP_4")],[r]:{type:r,value:_(s,"value"),error:_(s,"error")}},0,"uP_5"),[r]:{name:r,validate:_(f,"telephone")}},3,"uP_6"),l(u,{name:"code",get validate(){return f.code},children:(s,v)=>{var k,C,R;return l(I,{...v,type:"text",placeholder:`输入验证码`,get value(){return s.value},get error(){return s.error},children:b("div",{"q:slot":"suffix"},null,l(_e,{get type(){return a.value},params:{email:(k=c.internal.fields.email)==null?void 0:k.value,telephone:(C=c.internal.fields.telephone)==null?void 0:C.value,telephone_area_code:(R=c.internal.fields.telephone_area_code)==null?void 0:R.value,type:2},[r]:{type:z(U=>U.value,[a])}},3,"uP_7"),1,null),[r]:{type:r,value:_(s,"value"),error:_(s,"error")}},0,"uP_8")},[r]:{name:r,validate:_(f,"code")}},3,"uP_9"),l(u,{name:"password",get validate(){return f.password},children:(s,v)=>l(I,{...v,type:"password",placeholder:`输入您的新密码`,get value(){return s.value},get error(){return s.error},[r]:{type:r,value:_(s,"value"),error:_(s,"error")}},0,"uP_10"),[r]:{name:r,validate:_(f,"password")}},3,"uP_11"),l(u,{name:"cf_token",children:(s,v)=>l(Y,{...v,type:3,get value(){return s.value},onChange$:d(()=>p(()=>Promise.resolve().then(()=>he),void 0),"s_NwwhuhjmnIo",[s]),class:"mb-6",[r]:{type:r,value:_(s,"value"),class:r}},0,"uP_12"),[r]:{name:r}},3,"uP_13"),l(X,{type:"submit",get loading(){return i.value},class:"bg-primary mb-6 w-full",children:`重置密码`,[r]:{type:r,loading:z(s=>s.value,[i]),class:r}},1,"uP_14"),b("p",null,{class:"text-center text-sm text-zinc-500"},[`返回登录`," ",l(Z,{href:"/account/sign-in",class:"text-primary hover:underline",children:`登录`,[r]:{href:r,class:r}},1,"uP_15")],1,null)],[r]:{onSubmit$:r,class:r}},1,"uP_16")},Ue=Object.freeze(Object.defineProperty({__proto__:null,s_xb0045w4Bls:ce},Symbol.toStringTag,{value:"Module"})),de=()=>{const[e]=h();e.value="mobile"},pe=Object.freeze(Object.defineProperty({__proto__:null,s_LL0ZzADe13I:de},Symbol.toStringTag,{value:"Module"})),me=e=>{const[t]=h();t.value=e},he=Object.freeze(Object.defineProperty({__proto__:null,s_NwwhuhjmnIo:me},Symbol.toStringTag,{value:"Module"})),ve=e=>{const[t]=h(),n=j(O(E(),D(/^\d+$/,t.code.digitsOnly),A(6,t.code.length)),e||"");return n.success?"":n.issues[0].message},ge=Object.freeze(Object.defineProperty({__proto__:null,_hW:P,s_u5uQPBR8gos:ve},Symbol.toStringTag,{value:"Module"}));async function Qe(e,t){return w("/v1/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},data:e})}async function Ne(e,t){return w("/v1/auth/login/telephone",{method:"POST",headers:{"Content-Type":"application/json"},data:e})}async function Xe(e,t){return w("/v1/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},data:e})}async function Ge(e,t){return w("/v1/auth/register/telephone",{method:"POST",headers:{"Content-Type":"application/json"},data:e})}async function fe(e,t){return w("/v1/auth/reset",{method:"POST",headers:{"Content-Type":"application/json"},data:e})}async function be(e,t){return w("/v1/auth/reset/telephone",{method:"POST",headers:{"Content-Type":"application/json"},data:e})}const ye=async e=>{const[t,n,o]=h();try{switch(t.value=!0,o.value){case"email":await fe({email:e.email,password:e.password,code:e.code,cf_token:e.cf_token}).then(a=>{var i;(i=a.data.data)!=null&&i.token&&M(a.data.data.token)});break;case"mobile":await be({telephone:e.telephone,telephone_area_code:e.telephone_area_code,password:e.password,code:e.code,cf_token:e.cf_token}).then(a=>{var i;(i=a.data.data)!=null&&i.token&&M(a.data.data.token)});break}}catch{n.internal.fields.cf_token&&(n.internal.fields.cf_token.value="")}finally{t.value=!1}},Pe=Object.freeze(Object.defineProperty({__proto__:null,_hW:P,s_vtm9x6XoTaw:ye},Symbol.toStringTag,{value:"Module"})),we=()=>{const[e]=h();e.value="email"},Te=Object.freeze(Object.defineProperty({__proto__:null,s_530x0LBC164:we},Symbol.toStringTag,{value:"Module"})),xe=e=>{const[t]=h(),n=j(O(E(),V(6,t.password.minLength),B(20,t.password.maxLength)),e||"");return n.success?"":n.issues[0].message},Ie=Object.freeze(Object.defineProperty({__proto__:null,_hW:P,s_qw4PkSXqJLU:xe},Symbol.toStringTag,{value:"Module"})),Ee=e=>{const[t]=h();t.internal.fields.telephone_area_code&&(t.internal.fields.telephone_area_code.value=e.callingCode.replace("+",""))},Se=Object.freeze(Object.defineProperty({__proto__:null,_hW:P,s_PL7QavR9mvo:Ee},Symbol.toStringTag,{value:"Module"})),qe=e=>{var y;const[t,n]=h(),a=`+${(y=t.internal.fields.telephone_area_code)==null?void 0:y.value}${e}`;return J(a)?W(a)?"":n.telephone.impossible:n.telephone.invalid},Le=Object.freeze(Object.defineProperty({__proto__:null,_hW:P,s_FsUxrql0ffs:qe},Symbol.toStringTag,{value:"Module"}));export{_e as S,P as _hW,E as a,V as b,Ge as c,Xe as d,F as e,Ue as i,A as l,B as m,O as p,D as r,j as s,ie as s_0Pww1bpBLjw,we as s_530x0LBC164,qe as s_FsUxrql0ffs,de as s_LL0ZzADe13I,me as s_NwwhuhjmnIo,Ee as s_PL7QavR9mvo,se as s_pUCzfI03sjc,xe as s_qw4PkSXqJLU,ve as s_u5uQPBR8gos,ye as s_vtm9x6XoTaw,ce as s_xb0045w4Bls,Ne as t,Qe as u};
