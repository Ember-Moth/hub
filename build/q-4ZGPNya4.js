import{u as m,E as U,p as k,B as z,q as u,o,m as e,e as h,i as s,l as F,_ as f}from"./q-gSxxJeWo.js";import{s as I,p as S,e as Y,a as O,c as B,d as Q,l as G,r as $,S as W,m as H,b as K}from"./q-BHN7C-TJ.js";import{C as j,O as N,B as X}from"./q-BG3_QTyM.js";import{f as J,e as Z}from"./q-BMQMcSac.js";import{a2 as ee,a3 as te,a0 as T,a1 as ne}from"./q-DuNBRwv3.js";import{_ as d}from"./q-BKaOGYNW.js";import"./q-B5TFmh5c.js";import{L as ae}from"./q-C_B9_CLk.js";import{T as re}from"./q-BQapYjCx.js";import"./q-CvYgVdLJ.js";import{u as oe}from"./q-Am9eSDJS.js";import"./q-C2B8HMMM.js";import"./q-CRLhHez8.js";import"./q-DXZy683x.js";const se=()=>{const[n]=m();n.value="mobile"},le=Object.freeze(Object.defineProperty({__proto__:null,s_16PtgeReVRQ:se},Symbol.toStringTag,{value:"Module"})),ie=n=>{const[a,r]=m();if(!n)return r.email.invalid;const g=I(S(O(),Y(r.email.invalid)),n||"");if(!g.success)return g.issues[0].message;if(a.restrictions.emailDomainWhitelist.enabled){const l=n.split("@")[1],c=a.restrictions.emailDomainWhitelist.domains;if(c.length>0&&!c.includes(l))return r.email.domainNotAllowed}return""},_e=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_GxXnEK0wRh4:ie},Symbol.toStringTag,{value:"Module"})),ce=n=>{var l;const[a,r]=m(),g=(l=a.internal.fields.password)==null?void 0:l.value;return n!==g?r.password.mismatch:""},ue=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_p0P2HFciSSU:ce},Symbol.toStringTag,{value:"Module"})),de=async n=>{const[a,r,g]=m();try{switch(a.value=!0,g.value){case"email":await Q({email:n.email,password:n.password,invite:n.invite,code:n.code,cf_token:n.cf_token}).then(l=>{var c;(c=l.data.data)!=null&&c.token&&j(l.data.data.token)});break;case"mobile":await B({telephone:n.telephone,telephone_area_code:n.telephone_area_code,password:n.password,invite:n.invite,code:n.code,cf_token:n.cf_token}).then(l=>{var c;(c=l.data.data)!=null&&c.token&&j(l.data.data.token)});break}}catch{r.internal.fields.cf_token&&(r.internal.fields.cf_token.value="")}finally{a.value=!1}},me=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_mib3t7GZk1c:de},Symbol.toStringTag,{value:"Module"})),pe=()=>{const[n]=m();setTimeout(()=>{const r=new URLSearchParams(window.location.search).get("ref");r&&(J(n,"invite",r),localStorage.setItem("invite_code",r))},0)},he=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_vKr7YEBz0lg:pe},Symbol.toStringTag,{value:"Module"})),ge=()=>{const[n]=m();n.value="email"},ve=Object.freeze(Object.defineProperty({__proto__:null,s_WMGQ0TY6tHA:ge},Symbol.toStringTag,{value:"Module"})),be=n=>{var x;const[a,r]=m(),l=`+${(x=a.internal.fields.telephone_area_code)==null?void 0:x.value}${n}`;return ee(l)?te(l)?"":r.telephone.impossible:r.telephone.invalid},fe=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_rRMUyRt0snY:be},Symbol.toStringTag,{value:"Module"})),ye=n=>{const[a]=m(),r=I(S(O(),$(/^\d+$/,a.code.digitsOnly),G(6,a.code.length)),n||"");return r.success?"":r.issues[0].message},Te=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_C0Byk9sFwXc:ye},Symbol.toStringTag,{value:"Module"})),Ye=()=>{U();const n=oe(),{auth:{register:{stop_register:a},email:{enable:r,enable_verify:g,enable_domain_suffix:l,domain_suffix_list:c},mobile:{enable:q,enable_whitelist:x,whitelist:L}},invite:{forced_invite:M}}=n.config,i={methods:{email:r,mobile:q},restrictions:{forceInvite:M,disabled:a,emailVerification:g,emailDomainWhitelist:{enabled:l,domains:c.split(`
`).map(t=>t.trim())},mobileWhitelist:{enabled:x,numbers:L}}},v=k(i.methods.email?"email":i.methods.mobile?"mobile":"email"),P=k(!1),[b,{Form:V,Field:y}]=Z({loader:{value:{telephone_area_code:"1",telephone:"",email:"",password:"",repeat_password:"",code:"",invite:"",cf_token:""}}}),A=u(()=>d(()=>Promise.resolve().then(()=>me),void 0),"s_mib3t7GZk1c",[P,b,v]),w={email:{invalid:`无效的电子邮件地址`,domainNotAllowed:`不允许使用该电子邮件域名`},telephone:{invalid:`无效的电话号码`,impossible:`电话号码无效`},password:{minLength:`密码至少为6个字符`,maxLength:`密码最多为20个字符`,mismatch:`密码不匹配`},code:{digitsOnly:`验证码必须仅包含数字`,length:`验证码必须为6位数字`}},p={email:u(()=>d(()=>Promise.resolve().then(()=>_e),void 0),"s_GxXnEK0wRh4",[i,w]),telephone:u(()=>d(()=>Promise.resolve().then(()=>fe),void 0),"s_rRMUyRt0snY",[b,w]),password:u(()=>d(()=>Promise.resolve().then(()=>Ie),void 0),"s_DUgy4npUTq8",[w]),repeatPassword:u(()=>d(()=>Promise.resolve().then(()=>ue),void 0),"s_p0P2HFciSSU",[b,w]),code:u(()=>d(()=>Promise.resolve().then(()=>Te),void 0),"s_C0Byk9sFwXc",[w])};return z(u(()=>d(()=>Promise.resolve().then(()=>he),void 0),"s_vKr7YEBz0lg",[b])),o(V,{onSubmit$:A,class:"w-full",children:[h("div",null,{class:"mb-11 text-center"},[h("h1",null,{class:"mb-3 text-2xl font-bold"},`注册`,1,null),h("p",null,{class:"text-sm"},`您的社交活动`,1,null)],1,null),o(N,null,3,"8g_0"),i.restrictions.disabled&&h("div",null,{class:"mb-4 text-center text-red-500"},`当前注册已禁用`,1,"8g_1"),!i.methods.email&&!i.methods.mobile&&h("div",null,{class:"mb-4 text-center text-red-500"},`没有可用的注册方式`,1,"8g_2"),i.methods.email&&v.value==="email"&&o(y,{name:"email",get validate(){return p.email},children:(t,_)=>o(T,{..._,type:"email",label:`电子邮件`,description:`您的电子邮件地址`,placeholder:`输入您的电子邮件地址`,get value(){return t.value},get error(){return t.error},children:i.methods.mobile&&h("button",{"q:slot":"extra"},{class:"text-primary cursor-pointer text-sm hover:underline",type:"button",onClick$:u(()=>d(()=>Promise.resolve().then(()=>le),void 0),"s_16PtgeReVRQ",[v])},`切换到电话号码`,1,"8g_3"),[e]:{type:e,value:s(t,"value"),error:s(t,"error")}},0,"8g_4"),[e]:{name:e,validate:s(p,"email")}},3,"8g_5"),i.methods.mobile&&v.value==="mobile"&&o(y,{name:"telephone",get validate(){return p.telephone},children:(t,_)=>o(T,{..._,type:"tel",label:`电话号码`,description:`您的电话号码`,placeholder:`输入您的电话号码`,get value(){return t.value},get error(){return t.error},children:[h("div",{"q:slot":"prefix"},null,o(ne,{onChange$:u(()=>d(()=>Promise.resolve().then(()=>Oe),void 0),"s_cBJVO0QRC7w",[b])},2,"8g_6"),1,null),i.methods.email&&h("button",{"q:slot":"extra"},{class:"text-primary cursor-pointer text-sm hover:underline",type:"button",onClick$:u(()=>d(()=>Promise.resolve().then(()=>ve),void 0),"s_WMGQ0TY6tHA",[v])},`切换到电子邮件`,1,"8g_7")],[e]:{type:e,value:s(t,"value"),error:s(t,"error")}},0,"8g_8"),[e]:{name:e,validate:s(p,"telephone")}},3,"8g_9"),(v.value==="email"&&i.restrictions.emailVerification||v.value==="mobile")&&o(y,{name:"code",get validate(){return p.code},children:(t,_)=>{var E,R,C;return o(T,{..._,type:"text",placeholder:`输入验证码`,get value(){return t.value},get error(){return t.error},children:h("div",{"q:slot":"suffix"},null,o(W,{get type(){return v.value},params:{email:(E=b.internal.fields.email)==null?void 0:E.value,telephone:(R=b.internal.fields.telephone)==null?void 0:R.value,telephone_area_code:(C=b.internal.fields.telephone_area_code)==null?void 0:C.value,type:1},[e]:{type:F(D=>D.value,[v])}},3,"8g_10"),1,null),[e]:{type:e,value:s(t,"value"),error:s(t,"error")}},0,"8g_11")},[e]:{name:e,validate:s(p,"code")}},3,"8g_12"),o(y,{name:"password",get validate(){return p.password},children:(t,_)=>o(T,{..._,type:"password",autoComplete:"off",placeholder:`输入您的密码`,get value(){return t.value},get error(){return t.error},[e]:{type:e,autoComplete:e,value:s(t,"value"),error:s(t,"error")}},0,"8g_13"),[e]:{name:e,validate:s(p,"password")}},3,"8g_14"),o(y,{name:"repeat_password",get validate(){return p.repeatPassword},children:(t,_)=>o(T,{..._,type:"password",autoComplete:"off",placeholder:`确认您的密码`,get value(){return t.value},get error(){return t.error},[e]:{type:e,autoComplete:e,value:s(t,"value"),error:s(t,"error")}},0,"8g_15"),[e]:{name:e,validate:s(p,"repeatPassword")}},3,"8g_16"),o(y,{name:"invite",children:(t,_)=>o(T,{..._,type:"text",placeholder:`输入您的邀请码 ${i.restrictions.forceInvite?"":`(${`可选`})`}`,get value(){return t.value},get error(){return t.error},get required(){return i.restrictions.forceInvite},[e]:{type:e,value:s(t,"value"),error:s(t,"error"),required:s(i.restrictions,"forceInvite")}},0,"8g_17"),[e]:{name:e}},3,"8g_18"),o(y,{name:"cf_token",children:(t,_)=>o(re,{..._,type:2,get value(){return t.value},onChange$:u(()=>d(()=>Promise.resolve().then(()=>xe),void 0),"s_n7FL31s0y6Y",[t]),class:"mb-6",[e]:{type:e,value:s(t,"value"),class:e}},0,"8g_19"),[e]:{name:e}},3,"8g_20"),o(X,{type:"submit",get loading(){return P.value},class:"bg-primary mb-6 w-full",get disabled(){return i.restrictions.disabled},children:`注册`,[e]:{type:e,loading:F(t=>t.value,[P]),class:e,disabled:s(i.restrictions,"disabled")}},1,"8g_21"),h("p",null,{class:"text-center text-sm text-zinc-500"},[`已经是会员？`," ",o(ae,{href:"/account/sign-in",class:"text-primary hover:underline",children:`登录`,[e]:{href:e,class:e}},1,"8g_22")],1,null)],[e]:{onSubmit$:e,class:e}},1,"8g_23")},we=n=>{const[a]=m();a.value=n},xe=Object.freeze(Object.defineProperty({__proto__:null,s_n7FL31s0y6Y:we},Symbol.toStringTag,{value:"Module"})),Pe=n=>{const[a]=m(),r=I(S(O(),K(6,a.password.minLength),H(20,a.password.maxLength)),n||"");return r.success?"":r.issues[0].message},Ie=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_DUgy4npUTq8:Pe},Symbol.toStringTag,{value:"Module"})),Se=n=>{const[a]=m();a.internal.fields.telephone_area_code&&(a.internal.fields.telephone_area_code.value=n.callingCode.replace("+",""))},Oe=Object.freeze(Object.defineProperty({__proto__:null,_hW:f,s_cBJVO0QRC7w:Se},Symbol.toStringTag,{value:"Module"}));export{ce as a,de as b,pe as c,ge as d,be as e,ye as f,Ye as g,we as h,Pe as i,Se as j,ie as s,se as s_16PtgeReVRQ};
