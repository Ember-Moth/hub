import{b as Q,q as d,u as h,E as N,p as $,o as l,m as o,e as b,i as _,l as z,_ as P}from"./q-gSxxJeWo.js";import{_ as p}from"./q-BKaOGYNW.js";import{r as w,B as X,C as M}from"./q-BG3_QTyM.js";import"./q-B5TFmh5c.js";import{a0 as I,a1 as G,a2 as J,a3 as W}from"./q-DuNBRwv3.js";import{L as Z}from"./q-C_B9_CLk.js";import{T as Y}from"./q-BQapYjCx.js";import"./q-CvYgVdLJ.js";import{e as K}from"./q-BMQMcSac.js";import{u as H}from"./q-Am9eSDJS.js";import"./q-C2B8HMMM.js";import"./q-CRLhHez8.js";import"./q-DXZy683x.js";var ee=/^[\w+-]+(?:\.[\w+-]+)*@[\da-z]+(?:[.-][\da-z]+)*\.[a-z]{2,}$/iu,g;function te(e){return{lang:(e==null?void 0:e.lang)??(g==null?void 0:g.lang),message:e==null?void 0:e.message,abortEarly:(e==null?void 0:e.abortEarly)??(g==null?void 0:g.abortEarly),abortPipeEarly:(e==null?void 0:e.abortPipeEarly)??(g==null?void 0:g.abortPipeEarly)}}var S;function ne(e){return S==null?void 0:S.get(e)}var q;function ae(e){return q==null?void 0:q.get(e)}var L;function re(e,t){var n;return(n=L==null?void 0:L.get(e))==null?void 0:n.get(t)}function oe(e){var n,r;const t=typeof e;return t==="string"?`"${e}"`:t==="number"||t==="bigint"||t==="boolean"?`${e}`:t==="object"||t==="function"?(e&&((r=(n=Object.getPrototypeOf(e))==null?void 0:n.constructor)==null?void 0:r.name))??"null":t}function T(e,t,n,r,a){const i=a&&"input"in a?a.input:n.value,c=(a==null?void 0:a.expected)??e.expects??null,y=(a==null?void 0:a.received)??oe(i),u={kind:e.kind,type:e.type,input:i,expected:c,received:y,message:`Invalid ${t}: ${c?`Expected ${c} but r`:"R"}eceived ${y}`,requirement:e.requirement,path:a==null?void 0:a.path,issues:a==null?void 0:a.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},x=e.kind==="schema",m=(a==null?void 0:a.message)??e.message??re(e.reference,u.lang)??(x?ae(u.lang):null)??r.message??ne(u.lang);m&&(u.message=typeof m=="function"?m(u):m),x&&(n.typed=!1),n.issues?n.issues.push(u):n.issues=[u]}function F(e){return{kind:"validation",type:"email",reference:F,expects:null,async:!1,requirement:ee,message:e,_run(t,n){return t.typed&&!this.requirement.test(t.value)&&T(this,"email",t,n),t}}}function A(e,t){return{kind:"validation",type:"length",reference:A,async:!1,expects:`${e}`,requirement:e,message:t,_run(n,r){return n.typed&&n.value.length!==this.requirement&&T(this,"length",n,r,{received:`${n.value.length}`}),n}}}function V(e,t){return{kind:"validation",type:"max_length",reference:V,async:!1,expects:`<=${e}`,requirement:e,message:t,_run(n,r){return n.typed&&n.value.length>this.requirement&&T(this,"length",n,r,{received:`${n.value.length}`}),n}}}function B(e,t){return{kind:"validation",type:"min_length",reference:B,async:!1,expects:`>=${e}`,requirement:e,message:t,_run(n,r){return n.typed&&n.value.length<this.requirement&&T(this,"length",n,r,{received:`${n.value.length}`}),n}}}function D(e,t){return{kind:"validation",type:"regex",reference:D,async:!1,expects:`${e}`,requirement:e,message:t,_run(n,r){return n.typed&&!this.requirement.test(n.value)&&T(this,"format",n,r),n}}}function E(e){return{kind:"schema",type:"string",reference:E,expects:"string",async:!1,message:e,_run(t,n){return typeof t.value=="string"?t.typed=!0:T(this,"type",t,n),t}}}function j(...e){return{...e[0],pipe:e,_run(t,n){for(const r of e)if(r.kind!=="metadata"){if(t.issues&&(r.kind==="schema"||r.kind==="transformation")){t.typed=!1;break}(!t.issues||!n.abortEarly&&!n.abortPipeEarly)&&(t=r._run(t,n))}return t}}}function O(e,t,n){const r=e._run({typed:!1,value:t},te(n));return{typed:r.typed,success:!r.issues,output:r.value,issues:r.issues}}async function De(e,t){return w("/v1/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},data:e})}async function Ue(e,t){return w("/v1/auth/login/telephone",{method:"POST",headers:{"Content-Type":"application/json"},data:e})}async function Qe(e,t){return w("/v1/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},data:e})}async function Ne(e,t){return w("/v1/auth/register/telephone",{method:"POST",headers:{"Content-Type":"application/json"},data:e})}async function se(e,t){return w("/v1/auth/reset",{method:"POST",headers:{"Content-Type":"application/json"},data:e})}async function le(e,t){return w("/v1/auth/reset/telephone",{method:"POST",headers:{"Content-Type":"application/json"},data:e})}const ie=Q(d(()=>p(()=>import("./q-D7S7SILt.js"),[]),"s_kaWKx8yxWf4")),ue=e=>{const[t]=h();if(!e)return t.email.invalid;const n=O(j(E(),F(t.email.invalid)),e||"");return n.success?"":n.issues[0].message},_e=Object.freeze(Object.defineProperty({__proto__:null,_hW:P,s_pUCzfI03sjc:ue},Symbol.toStringTag,{value:"Module"})),ce=e=>{var a;const[t,n]=h(),r=(a=t.internal.fields.password)==null?void 0:a.value;return e!==r?n.password.mismatch:""},de=Object.freeze(Object.defineProperty({__proto__:null,_hW:P,s_0Pww1bpBLjw:ce},Symbol.toStringTag,{value:"Module"})),Xe=()=>{N();const e=H(),{auth:{email:{enable:t},mobile:{enable:n}}}=e.config,r={methods:{email:t,mobile:n}},a=$(r.methods.email?"email":r.methods.mobile?"mobile":"email"),i=$(!1),[c,{Form:y,Field:u}]=K({loader:{value:{telephone_area_code:"1",telephone:"",email:"",password:"",code:"",cf_token:""}}}),x=d(()=>p(()=>Promise.resolve().then(()=>ye),void 0),"s_vtm9x6XoTaw",[i,c,a]),m={email:{invalid:`无效的电子邮件地址`,domainNotAllowed:`不允许使用该电子邮件域名`},telephone:{invalid:`无效的电话号码`,impossible:`电话号码无效`},password:{minLength:`密码至少为6个字符`,maxLength:`密码最多为20个字符`,mismatch:`密码不匹配`},code:{digitsOnly:`验证码必须仅包含数字`,length:`验证码必须为6位数字`}},f={email:d(()=>p(()=>Promise.resolve().then(()=>_e),void 0),"s_pUCzfI03sjc",[m]),telephone:d(()=>p(()=>Promise.resolve().then(()=>qe),void 0),"s_FsUxrql0ffs",[c,m]),password:d(()=>p(()=>Promise.resolve().then(()=>xe),void 0),"s_qw4PkSXqJLU",[m]),repeatPassword:d(()=>p(()=>Promise.resolve().then(()=>de),void 0),"s_0Pww1bpBLjw",[c,m]),code:d(()=>p(()=>Promise.resolve().then(()=>fe),void 0),"s_u5uQPBR8gos",[m])};return l(y,{onSubmit$:x,class:"w-full",children:[b("div",null,{class:"mb-11 text-center"},[b("h1",null,{class:"mb-3 text-2xl font-bold"},`忘记密码？`,1,null),b("p",null,{class:"text-sm"},`为您的账户创建一个新密码`,1,null)],1,null),r.methods.email&&a.value==="email"&&l(u,{name:"email",get validate(){return f.email},children:(s,v)=>l(I,{...v,type:"email",label:`电子邮件`,description:`您的电子邮件地址`,placeholder:`输入您的电子邮件地址`,get value(){return s.value},get error(){return s.error},children:r.methods.mobile&&b("button",{"q:slot":"extra"},{class:"text-primary cursor-pointer text-sm hover:underline",type:"button",onClick$:d(()=>p(()=>Promise.resolve().then(()=>me),void 0),"s_LL0ZzADe13I",[a])},`切换到电话号码`,1,"uP_0"),[o]:{type:o,value:_(s,"value"),error:_(s,"error")}},0,"uP_1"),[o]:{name:o,validate:_(f,"email")}},3,"uP_2"),r.methods.mobile&&a.value==="mobile"&&l(u,{name:"telephone",get validate(){return f.telephone},children:(s,v)=>l(I,{...v,type:"tel",label:`电话号码`,description:`您的电话号码`,placeholder:`输入您的电话号码`,get value(){return s.value},get error(){return s.error},children:[b("div",{"q:slot":"prefix"},null,l(G,{onChange$:d(()=>p(()=>Promise.resolve().then(()=>Ee),void 0),"s_PL7QavR9mvo",[c])},2,"uP_3"),1,null),r.methods.email&&b("button",{"q:slot":"extra"},{class:"text-primary cursor-pointer text-sm hover:underline",type:"button",onClick$:d(()=>p(()=>Promise.resolve().then(()=>we),void 0),"s_530x0LBC164",[a])},`切换到电子邮件`,1,"uP_4")],[o]:{type:o,value:_(s,"value"),error:_(s,"error")}},0,"uP_5"),[o]:{name:o,validate:_(f,"telephone")}},3,"uP_6"),l(u,{name:"code",get validate(){return f.code},children:(s,v)=>{var k,C,R;return l(I,{...v,type:"text",placeholder:`输入验证码`,get value(){return s.value},get error(){return s.error},children:b("div",{"q:slot":"suffix"},null,l(ie,{get type(){return a.value},params:{email:(k=c.internal.fields.email)==null?void 0:k.value,telephone:(C=c.internal.fields.telephone)==null?void 0:C.value,telephone_area_code:(R=c.internal.fields.telephone_area_code)==null?void 0:R.value,type:2},[o]:{type:z(U=>U.value,[a])}},3,"uP_7"),1,null),[o]:{type:o,value:_(s,"value"),error:_(s,"error")}},0,"uP_8")},[o]:{name:o,validate:_(f,"code")}},3,"uP_9"),l(u,{name:"password",get validate(){return f.password},children:(s,v)=>l(I,{...v,type:"password",placeholder:`输入您的新密码`,get value(){return s.value},get error(){return s.error},[o]:{type:o,value:_(s,"value"),error:_(s,"error")}},0,"uP_10"),[o]:{name:o,validate:_(f,"password")}},3,"uP_11"),l(u,{name:"cf_token",children:(s,v)=>l(Y,{...v,type:3,get value(){return s.value},onChange$:d(()=>p(()=>Promise.resolve().then(()=>ve),void 0),"s_NwwhuhjmnIo",[s]),class:"mb-6",[o]:{type:o,value:_(s,"value"),class:o}},0,"uP_12"),[o]:{name:o}},3,"uP_13"),l(X,{type:"submit",get loading(){return i.value},class:"bg-primary mb-6 w-full",children:`重置密码`,[o]:{type:o,loading:z(s=>s.value,[i]),class:o}},1,"uP_14"),b("p",null,{class:"text-center text-sm text-zinc-500"},[`返回登录`," ",l(Z,{href:"/account/sign-in",class:"text-primary hover:underline",children:`登录`,[o]:{href:o,class:o}},1,"uP_15")],1,null)],[o]:{onSubmit$:o,class:o}},1,"uP_16")},pe=()=>{const[e]=h();e.value="mobile"},me=Object.freeze(Object.defineProperty({__proto__:null,s_LL0ZzADe13I:pe},Symbol.toStringTag,{value:"Module"})),he=e=>{const[t]=h();t.value=e},ve=Object.freeze(Object.defineProperty({__proto__:null,s_NwwhuhjmnIo:he},Symbol.toStringTag,{value:"Module"})),ge=e=>{const[t]=h(),n=O(j(E(),D(/^\d+$/,t.code.digitsOnly),A(6,t.code.length)),e||"");return n.success?"":n.issues[0].message},fe=Object.freeze(Object.defineProperty({__proto__:null,_hW:P,s_u5uQPBR8gos:ge},Symbol.toStringTag,{value:"Module"})),be=async e=>{const[t,n,r]=h();try{switch(t.value=!0,r.value){case"email":await se({email:e.email,password:e.password,code:e.code,cf_token:e.cf_token}).then(a=>{var i;(i=a.data.data)!=null&&i.token&&M(a.data.data.token)});break;case"mobile":await le({telephone:e.telephone,telephone_area_code:e.telephone_area_code,password:e.password,code:e.code,cf_token:e.cf_token}).then(a=>{var i;(i=a.data.data)!=null&&i.token&&M(a.data.data.token)});break}}catch{n.internal.fields.cf_token&&(n.internal.fields.cf_token.value="")}finally{t.value=!1}},ye=Object.freeze(Object.defineProperty({__proto__:null,_hW:P,s_vtm9x6XoTaw:be},Symbol.toStringTag,{value:"Module"})),Pe=()=>{const[e]=h();e.value="email"},we=Object.freeze(Object.defineProperty({__proto__:null,s_530x0LBC164:Pe},Symbol.toStringTag,{value:"Module"})),Te=e=>{const[t]=h(),n=O(j(E(),B(6,t.password.minLength),V(20,t.password.maxLength)),e||"");return n.success?"":n.issues[0].message},xe=Object.freeze(Object.defineProperty({__proto__:null,_hW:P,s_qw4PkSXqJLU:Te},Symbol.toStringTag,{value:"Module"})),Ie=e=>{const[t]=h();t.internal.fields.telephone_area_code&&(t.internal.fields.telephone_area_code.value=e.callingCode.replace("+",""))},Ee=Object.freeze(Object.defineProperty({__proto__:null,_hW:P,s_PL7QavR9mvo:Ie},Symbol.toStringTag,{value:"Module"})),Se=e=>{var y;const[t,n]=h(),a=`+${(y=t.internal.fields.telephone_area_code)==null?void 0:y.value}${e}`;return J(a)?W(a)?"":n.telephone.impossible:n.telephone.invalid},qe=Object.freeze(Object.defineProperty({__proto__:null,_hW:P,s_FsUxrql0ffs:Se},Symbol.toStringTag,{value:"Module"}));export{ie as S,P as _hW,E as a,B as b,Ne as c,Qe as d,F as e,ce as f,Xe as g,pe as h,he as i,ge as j,be as k,A as l,V as m,Pe as n,Te as o,j as p,Ie as q,D as r,O as s,ue as s_pUCzfI03sjc,Ue as t,De as u,Se as v};
